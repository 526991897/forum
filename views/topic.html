<% include header.html %>
<ol class="breadcrumb">
    <li><a href="/">社区主页</a></li>
    <li><a href="/column/<%=column.id%>"><%=column.name%></a></li>
    <li class="active"><%=topic.title%></li>
</ol>

<div ng-controller="replyCtrl" ng-init='topicAuthorId = "<%=topic.authorId%>";topicId="<%=topic.id%>" ; columnId = "<%=column.id%>"'>

    <div class="panel panel-success">
        <div class="panel-heading"> <%=topic.title%> <a href="" ng-click="removeTopic()" class="btn btn-default btn-xs pull-right">删帖</a> <a
                href="#createReply" class="pull-right btn btn-default btn-xs pull-right"
                ng-click="moveEditor('createReply')">回帖</a></div>
        <div class="panel-body row">
            <div class="col-sm-2" ng-init="loadUser(topicAuthorId)">
                <img class="img-circle" width="100" height="100" ng-src='{{users[topicAuthorId].isCustomLogo ? "/logo/"+users[topicAuthorId].nickname : "http://www.gravatar.com/avatar/"+users[topicAuthorId].logo}}'/>
                <p>{{users[topicAuthorId].nickname}}</p>
            </div>
            <div class="col-sm-10">
                <h1><%=topic.title%></h1>

                <p><%=topic.body%></p>
            </div>
        </div>
        <ul class="list-group">
            <li class="list-group-item" ng-repeat="rid in replyIdsList" ng-show="replys[rid]">
                <div class="row">
                    <div class="col-sm-2">

                        <img class="img-circle" width="100" height="100" ng-src='{{users[replys[rid].authorId].isCustomLogo ? "/logo/"+users[replys[rid].authorId].nickname : "http://www.gravatar.com/avatar/"+users[replys[rid].authorId].logo}}'/>
                        <p>{{users[replys[rid].authorId].nickname}}</p>
                    </div>
                    <div class="col-sm-10" id="{{rid}}">
                        <p>{{replys[rid].title}} <a href="" ng-click="moveEditor(rid)">回复</a> <a href="" ng-click="removeReply(rid)">删除</a></p>

                        <p>{{replys[rid].body}}</p>

                        <ul class="list-group">
                            <li ng-show="replys[sr]" class="list-group-item list-group-item-info"
                                ng-repeat="sr in subReplyIds[rid]">
                                <img class="img-circle" width="40" height="40" ng-src='{{users[replys[sr].authorId].isCustomLogo ? "/logo/"+users[replys[sr].authorId].nickname : "http://www.gravatar.com/avatar/"+users[replys[sr].authorId].logo}}'/>
                                <p>{{users[replys[sr].authorId].nickname}}</p>
                                <p>{{replys[sr].title}} <a href="" ng-click="moveEditor(rid,sr)">回复</a> <a href="" ng-click="removeReply(sr)">删除</a> </p>
                                <p>{{replys[sr].body}}</p>
                            </li>
                        </ul>
                        <div><a href="" class="btn btn-default btn-xs" ng-show="showSubReplyPositions[rid] !== subReplyIds[rid].length" ng-click="moreSubReply(rid)">更多</a></div>

                    </div>
                </div>
            </li>

            <li ng-show="replyIdsList.length !== showReplyPosition" class="list-group-item"><a href="" class="btn btn-default btn-block" ng-click="moreReply()"> 更多 </a></li>
        </ul>
        <div class="panel-footer">
            <a
                    href="#createReply" class=" btn btn-default btn-xs"
                    ng-click="moveEditor('createReply')">回帖</a>
            <a href="" class="btn btn-default btn-xs">删帖</a>
        </div>
    </div>

    <div id="createReply">
        <reply-editor ng-show="true"></reply-editor>
    </div>

</div>

<% include footer.html %>