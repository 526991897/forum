<% include header.html %>

<ol class="breadcrumb">
    <li><a href="/">社区主页</a></li>
    <li class="active"><%=user.nickname%>的个人中心</li>
</ol>
<div ng-controller="userCtrl" ng-init="userId='<%=user.id%>';isCustomLogo = <%=user.isCustomLogo%> === true || false ">
  <tabset>
    <tab heading="基本资料">
        <table class="table table-striped">
            <tr>
                <td>头像</td>
                <td>
                    <img class="img-circle" width="100" height="100" ng-src='{{isCustomLogo ? "/logo/<%=user.nickname%>" : "http://www.gravatar.com/avatar/<%=user.logo%>"}}'/>
                    <%if(loginUser && loginUser.id === user.id){%>
                    <input type="file" name="logo" ng-file-select="onFileSelect($files)" >
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary"  ng-model="isCustomLogo" btn-radio="true">使用自定义头像</button>
                        <button type="button" class="btn btn-primary"  ng-model="isCustomLogo" btn-radio="false">使用Gravatar头像</button>
                    </div>
                    <%}%>
                </td>

            </tr>
            <tr>
                <td>昵称</td>
                <td>
                    <div><%=user.nickname || ""%></div>
                </td>
            </tr>
            <tr>
                <td>个人简介</td>
                <td><%=user.des || ""%></td>
            </tr>
            <tr>
                <td>性别</td>
                <td>
                    <%=user.sex?"男":"女"%>
                </td>
            </tr>
            <tr>

                <td>身份</td>

                <td>

                    <%if(user.role === 0){%>
                    用户
                    <%}%>
                    <%if(user.role === 1){%>
                    终极管理员
                    <%}%>

                    <%columnList.forEach(function(col){%>
                    <%if(col.managerId === user.id){%>
                    <p><strong><%=col.name%></strong>版主</p>
                    <%}else{%>
                    <p ng-show="user.role === 1" ><string><%=col.name%></string><a href="" ng-click="setManager('<%=user.id%>','<%=col.id%>')">设置管理员</a></p>
                    <%}%>
                    <%})%>

                </td>
            </tr>
            <tr>
                <td>所在地址</td>
                <td>
                    <div><%=user.address || ""%></div>
                </td>
            </tr>
        </table>
    </tab>
    <tab heading="主题帖" ng-click="loadTopicList()">
        <ul class="list-group">
            <li ng-repeat=" t in topicTitles" class="list-group-item">
                <a href="/topic/{{t.id}}">{{t.title}}</a>
            </li>
            <li  class="list-group-item">
                <pagination on-select-page="selectTopicPage(page)" total-items="bigTotalItems" page="bigCurrentPage" items-per-page="perPage" class="pagination-sm" boundary-links="true"></pagination>
            </li>
        </ul>

    </tab>
    <tab heading="回复帖" ng-click="loadReplyList()">
        <ul class="list-group">
            <li ng-repeat=" r in replys" class="list-group-item">
                <a href="/topic/{{r.topicId}}#{{r.id}}">回复：{{topics[r.topicId].title}}</a>
            </li>
            <li  class="list-group-item">
                <pagination on-select-page="selectReplyPage(page)" total-items="bigTotalItems2" page="bigCurrentPage2" items-per-page="perPage2" class="pagination-sm" boundary-links="true"></pagination>
            </li>
        </ul>
    </tab>
    <%if(loginUser && loginUser.id === user.id){%>
    <tab heading="私信" ng-click="loadMessageList()">
        <ul class="list-group">
            <li ng-repeat="m in messageList" class="list-group-item">
                {{m.body}}
            </li>
        </ul>
    </tab>
    <%}%>
    <tab heading="关注" ng-click="loadFollowList()">
        <a usercode user-id="{{uid}}" href="/user/{{uid}}" ng-repeat="uid in user.follows">
            <img class="img-circle" width="40" height="40" ng-src='{{users[uid].isCustomLogo ? "/logo/"+users[uid].nickname : "http://www.gravatar.com/avatar/"+users[uid].logo}}'/>
        </a>
    </tab>
    <tab heading="听众">
        <a usercode user-id="{{uid}}" href="/user/{{uid}}" ng-repeat="uid in user.watchers">
            <img class="img-circle" width="40" height="40" ng-src='{{users[uid].isCustomLogo ? "/logo/"+users[uid].nickname : "http://www.gravatar.com/avatar/"+users[uid].logo}}'/>
        </a>
    </tab>
  </tabset>
</div>
<% include footer.html %>